var exams_library_id;var selected=new Array();var allIds=new Array();var skip;var EVERY_ROW_SHOW=5;var currentPage;var totalPage;var count=5;var questionData={};
var isContinueLoad=false;function init(){if(request.exams_library_id&&request.exams_library_id!=null){exams_library_id=request.exams_library_id;}if(exams_library_id){getQuestionList(0,2,"list");
}else{tek.macCommon.waitDialogShow(null,"没有传入要题库ID");}$(".dropdown-toggle").dropdown();}function addQuestion(){var a=$("#question-type").val();var b=tek.common.getRootPath()+"http/ican/question/add.html?exams_library_id="+exams_library_id+"&exams_question_type="+a+"&show-close=1&refresh-opener=1";
window.open(b,"_blank");}function showAnswerList(a){if(!a){return;}var c="#question-"+a+"  .library-answer";var b=$(c);if(b.is(":visible")){b.hide("slow");
}else{b.show("slow");}}function getQuestionList(e,b,c){if(!exams_library_id){return;}if(b){exams_question_type=b;}selected=new Array();allIds=new Array();
var a=$("#question-list");if(!a){return;}if(c=="list"){a.html("");}var d={operateType:"获取问题列表"};var g={objectName:"ExamsQuestion",action:"getList",exams_library_id:exams_library_id,exams_question_type:exams_question_type,skip:e,order:"createTime",desc:1};
if(count){g.count=count;}var f={beforeSend:function(){a.append("<li id='waiting-img' style='text-align:center;list-style:none;'><img src='"+tek.common.getRootPath()+"http/images/waiting-small.gif'/></li>");
},success:function(k){$("#waiting-img").remove();var h=k.record;if(h){for(var j in h){showQuestion(h[j]);}showCustomListTurn(e,k);$(".library-question").removeClass("hidden");
$("#tekinfo_footer").css("position","relative");}else{if(k.value==0){$("#page-"+exams_question_type).html("");}a.append("<li class='answer-data-message' style='text-align:center;list-style:none;'>没有数据！</li>");
$("#page").addClass("hidden");$("#more_page_2").addClass("hidden");$(".library-question").addClass("hidden");$("#ajax-load-div").addClass("hidden");}},error:function(i,h){a.html("<li style='text-align:center;'>"+h+"</li>");
}};tek.common.ajax(tek.common.getRootPath()+"servlet/tobject",d,g,f);}function showQuestion(a){if(a){var d;var b="<div class='col-md-12' id='question-";
if(a.id){b+=a.id;}b+="'>";b+="<div class='library-question'>";b+="<input id='select";if(a.id){b+=a.id;}b+="' type='checkbox' value='";if(a.id){b+=a.id;
}b+="' onclick=\"selt(this, event)\"><a href='javascript:void(0);' class='question-heading' onclick='showAnswerList(\"";if(a.id){b+=a.id;}b+="\");'><span>";
d=a.exams_question_name;if(d&&d.show){b+=d.show||"";}b+="</span>";d=a.exams_question_end;if(d&&d.show){b+="<span style='color: rgb(92, 158, 145);'>(";b+=d.display;
b+=":";b+=d.show||"";b+=")</span>";}b+="</a>";b+="<div class='btn-group pull-right'>";b+="<button class='btn btn-xs btn-default' onclick='readQuestion(\"";
if(a.id){b+=a.id;}b+="\");'><i class='fa fa-check'></i></button>";b+="<button class='btn btn-xs btn-default' onclick='editQuestion(\"";if(a.id){b+=a.id;
}b+="\");'><i class='fa fa-pencil'></i> </button><button class='btn btn-xs btn-default' onclick='deleteQuestionInfo(\"";if(a.id){b+=a.id;}b+='","';d=a.exams_question_name;
if(d&&d.show){b+=d.show||"";}b+="\")'><i class='fa fa-times'></i> </button>";b+="</div>";b+="<div class='padd library-answer'>";b+="<div class='row' id='answer-list-";
if(a.id){b+=a.id;}b+="'></div></div></div></div>";var c=document.getElementById("question-list");if(c){c.insertAdjacentHTML("BeforeEnd",b);}if(a.id){readAnswerList(a.id);
}}}function readQuestion(a){if(!a&&!exams_library_id){return;}var b=tek.common.getRootPath()+"http/ican/question/read.html?exams_library_id="+exams_library_id+"&exams_question_id="+a;
window.open(b,"_blank");}function editQuestion(a){if(!a&&!exams_library_id){return;}var b=tek.common.getRootPath()+"http/ican/question/edit.html?exams_library_id="+exams_library_id+"&exams_question_id="+a+"&show-close=1&refresh-opener=1";
window.open(b,"_blank");}function deleteQuestionInfo(b,a){var c={};c.objectName="ExamsQuestion";c.action="removeInfo";c.question_id=b;tek.macList.removeInfo(b,a,c);
}function readAnswerList(a){if(!a){return;}var c={operateType:"获取答案列表"};var b={objectName:"ExamsAnswer",action:"getList",exams_question_id:a,desc:1};var d={beforeSend:function(){$("#answer-list-"+a).html("<li id='waiting-img' class='center'><img src='"+tek.common.getRootPath()+"http/images/waiting-small.gif'/></li>");
},success:function(g){$("#waiting-img").remove();var e=g.record;if(e){if(e.length){for(var f in e){appendAnswerField(e[f],a);}}else{appendAnswerField(e,a);
}}else{$("#answer-list-"+a).html("<li class='answer-data-message' style='text-align:center;'>没有数据！</li>");}},error:function(f,e){$("#answer-list-"+a).html("<li style='text-align:center;'>"+e+"</li>");
}};tek.common.ajax(tek.common.getRootPath()+"servlet/tobject",c,b,d);}function appendAnswerField(b,a){if(b){var d;var c="<div class='col-md-3 col-sm-6'><span>";
d=b.exams_answer_name;if(d&&d.show){c+=d.show||"";}d=b.exams_answer_correct;if(d&&(d.value==1)){c+="<i class='fa fa-check'></i>";}c+="</span>";c+="</div>";
$("#answer-list-"+a).append(c);}}function getLongDateByStringDate(c){var b=c;if(b){b=replaceMyString(b,"-","/");if(b){if(b.indexOf(":")<=0){b+=" 00:00:00";
}}else{b=c;}}var a=new Date(b);return a.getTime();}function replaceMyString(d,a,b){var c=d;if(d){do{c=c.replace(a,b);}while(c.indexOf(a)>-1);}return c;
}function changetype(a){isContinueLoad=false;if(a===2){$("#choose").text("单选题");$("#question-type").val(a);getQuestionList(0,a,"list");}else{if(a===4){$("#choose").text("多选题");
$("#question-type").val(a);getQuestionList(0,a,"list");$("#changeA").html("单选题");$("change").attr("onclick","changetype(2");}}$("#page").removeClass("hidden");
}function showCustomListTurn(c,d){var b=document.getElementById("page");if(!b){return;}b.innerHTML="";count=parseInt(count);if(!count){count=0;}var a=parseInt(d.value);
if(!a){a=0;}b.innerHTML=tek.turnPage.getPagination(c,count,a);currentPage=tek.turnPage.getCurrentPageNumber(c,count);totalPage=tek.turnPage.getTotalPageNumber(a,count);
if(currentPage<totalPage){isContinueLoad=true;$("#more_page_2").removeClass("hidden");$("#ajax-load-div").addClass("hidden");}else{isContinueLoad=false;
$("#more_page_2").addClass("hidden");$("#ajax-load-div").removeClass("hidden");}}function selAll(c,d){if(!c){return;}var b=document.getElementById("question-list").getElementsByTagName("input");
if(b&&b.length>0){for(var a in b){if(b[a]&&b[a].type=="checkbox"){if(!c.checked){b[a].checked="";}else{b[a].checked="checked";}selt(b[a],d);}}}}function selt(a,c){if(!a){return;
}var b=isArrayContain(selected,a.value);if(a.checked){if(b<0){selected.push(a.value);}}else{if(b>=0){delete selected[b];}}c=c?c:((window.event)?window.event:"");
if(c&&c.stopPropagation){c.stopPropagation();}else{if(window&&window.event&&window.event.cancelBubble){window.event.cancelBubble=true;}}}var isArrayContain=function(c,a){if(!c||!a){return -1;
}for(var b=0;b<c.length;b++){if(c[b]==a){return b;}}return -1;};$(window).scroll(function(){if(!isContinueLoad){return;}if(($(this).scrollTop()+2)>=($(document).height()-$(this).height())){isContinueLoad=false;
$("#page").addClass("hidden");changePage(null,(currentPage*count));}});function scrollFn(){if(!isContinueLoad){return;}if(($(this).scrollTop()+2)>=($(document).height()-$(this).height())){isContinueLoad=false;
$("#page").addClass("hidden");changePage(null,(currentPage*count));}}function morePage(){if(currentPage<totalPage){if(!$("#question-content").is(":visible")){$(".wminimize").click();
}isContinueLoad=false;$("#page").addClass("hidden");changePage(null,(currentPage*count));}else{$("#ajax-load-div").removeClass("hidden");$("#page").addClass("hidden");
$("#more_page_2").addClass("hidden");}}function changePage(c,b){var a=$("#question-type").val();getQuestionList(b,a,"page");}